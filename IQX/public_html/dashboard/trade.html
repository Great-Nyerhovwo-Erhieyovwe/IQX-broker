<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQX | Trade</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <!-- font awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <!-- chart cdn -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="light-mode">
    <div id="dashboard-container">
        <!-- sidebar -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <h2>IQX</h2>
            </div>
            <nav>
                <ul>
                    <li><a href="dashboard.html"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
                    <li><a href="market.html"><i class="fa-solid fa-chart-line"></i><span>Market & Pairs</span></a></li>
                    <li><a href="trade.html" class="active"><i
                                class="fa-solid fa-money-bill-trend-up"></i><span>Trade</span></a></li>
                    <li><a href="deposit.html"><i class="fa-solid fa-money-bill-transfer"></i><span>Deposit</span></a>
                    </li>
                    <li><a href="#"><i class="fas arrow-up"></i><span>Withdraw</span></a></li>

                    <!-- <h3>General</h3> -->
                    <li><a href="settings.html"><i class="fa-solid fa-user-gear"></i><span>Settings</span></a></li>
                    <li><a href="support.html"><i class="fa-solid fa-ticket"></i><span>Support</span></a></li>
                    <li><a href="../login/login.html"><i class="fa-solid fa-arrow-left"></i><span>Logout</span></a></li>
                </ul>
            </nav>


            <!-- theme toggle -->
            <div class="sidebar-footer">
                <button id="theme-toggle" class="sidebar-btn">
                    <i class="fas fa-moon"></i><span>Toggle Theme</span>
                </button>
                <button id="profile-btn" class="sidebar-btn profile-sidebar-btn">
                    <i class="fas fa-user-plus"></i><span>Profile</span>
                </button>
            </div>
        </aside>

        <!-- main content area -->
        <div id="main-content">
            <!-- top nav bar -->
            <header id="navbar">
                <div class="navbar-left">
                    <button id="sidebar-toggle" class="hamburger-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <span class="company-name">IQX</span>
                </div>

                <div class="navbar-left">
                    <div id="profile-dropdown" class="profile-container">
                        <div class="profile-info">
                            <span id="profileName"></span>
                            <img src="https://i.pravatar.cc/150?u=emmalex" alt="User Avatar" class="profile-avatar" />
                        </div>
                        <div class="dropdown-menu hidden">
                            <a href="#">Settings</a>
                            <a href="../login/login.html">Logout</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- page content for notes -->
            <main id="content" class="trade-overview">
                <h1 id="page-title">Trade Dashboard</h1>

                <div>
                <span class="card-title">Available Balance:</span> <br>
                <p><span class="card-value positive" id="balanceAmount">$0.00</span></p> <br>
                </div>

                <button onclick="openModal()" id="addTradeBtn" class="primary-btn">Add Trade</button>

                <!-- chart -->
                <div class="chart-container">
                    <canvas id="marketChart"></canvas>
                </div>

                <!-- Trade History -->
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Asset</th>
                            <th>Amount</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="tradeTable"></tbody>
                </table>

                <!-- modal -->
                <div id="tradeModal" class="trade-modal">
                    <div class="trade-modal-content">
                        <h3>Add Trade</h3>
                        <select id="tradeType">
                            <option value="Buy">Buy</option>
                            <option value="Sell">Sell</option>
                        </select>

                        <input type="text" id="asset" placeholder="Asset (e.g. BTC)">
                        <input type="number" id="amount" placeholder="Amount">
                        <input type="number" id="price" placeholder="Price">
                        <button onclick="submitTrade()" class="primary-btn">Submit</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>


    <!-- Inline and External Js -->
    <script>
        // === Trade Module ===
        const ctx = document.getElementById('marketChart').getContext('2d');

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['9AM', '10AM', '11AM', '12PM', '1PM'],
                datasets: [{
                    label: 'Market Price',
                    data: [100, 120, 110, 130, 125],
                    borderColor: 'blue',
                    fill: false,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: false }
                }
            }
        });

        function openModal() {
            document.getElementById('tradeModal').classList.add('active');
        }

        window.onclick = function (e) {
            if (e.target.id === 'tradeModal') {
                e.target.classList.remove('active');
            }
        }


        let balance = 1000;
        let trades = [];

        document.getElementById('balance').textContent = balance.toFixed(2);

        function submitTrade() {
            const type = document.getElementById('type');
            const asset = document.getElementById('asset').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const price = parseFloat(document.getElementById('price').value);

            if (!asset || isNaN(amount) || isNaN(price) || amount <= 0 || price <= 0) {
                alert('Enter a valid trade info.');
                return;
            }

            const total = amount * price;
            if (type === 'Buy' && total > balance) {
                alert('Not enough balance.');
                return;
            }

            // Adjust balance
            balance += type === 'Sell' ? total : -total;

            // save and display trade
            trades.push({type, asset, amount, price, total});

            localStorage.setItem('balance', balance.toFixed(2));
            localStorage.setItem('trades', JSON.stringify(trades));
            updateTable();

            document.getElementById('balance').textContent = balance.toFixed(2);

            // clear inputs
            document.getElementById('asset').value = '';

            document.getElementById('amount').value = '';

            document.getElementById('price').value = '';

            // close modal
            document.getElementById('tradeModal').classList.remove('active');

  }

  function updateTable() {
            const tbody = document.getElementById('tradeTable');
            tbody.innerHTML = '';
            trades.forEach(t => {
                tbody.innerHTML += `
        <tr>
        <td>${t.type}</td>
        <td>${t.asset}</td>
        <td>${t.amount}</td>
        <td>${t.price}</td>
        <td>${t.total.toFixed(2)}</td>
        `;
        });
    }

    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="../assets/js/dashboard.js"></script>
</body>

</html>